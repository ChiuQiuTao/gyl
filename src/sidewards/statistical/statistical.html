<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="../../../js/module/jquery-3.4.1.min.js"></script>
    <script src="../../../public/mui/echarts-all.js"></script>
    <style>
        .chart {
            height: 300px;
        }
        body{
            overflow-x:hidden;
            overflow-y:hidden;
        }
    </style>

</head>
<body>
<blockquote class="layui-elem-quote">
    销售报表数据
</blockquote>
<div class="layui-row layui-col-space15">
    <div class="layui-col-md6">
        <div class="layui-card">
            <div class="layui-card-body">
                <table class="layui-table" id="test">  </table>
            </div>
        </div>
    </div>
    <div class="layui-col-md6">
        <div class="layui-card">
            <div class="layui-card-body">
                <div  style="height: 222px;" id="xsje"></div>
            </div>
        </div>
    </div>
</div>
<div class="layui-row layui-col-space15">
    <div class="layui-col-md6">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="chart" id="barChart"></div>
            </div>
        </div>
    </div>
    <div class="layui-col-md6">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="chart" id="bold"></div>
            </div>
        </div>
    </div>
</div>
<script>
    var tableData = null;
    var datas = new Array();
    var zxtdatas = new Array();
    layui.use('table', function(){
        var table = layui.table
        $ = layui.jquery;
        table.render({
            elem: '#test'
            ,url:'./data/salesreport.json'
            ,cols: [[
                {field:'jd',   title: '季度',align:"center"}
                ,{field:'zb',   title: '占比', sort: true,align:"center",templet:function (data) {
                        return percent(data.xsje,data.total)+"%"
                    }}
                ,{field:'xsje',  title: '销售金额(万)',align:"center" ,sort: true}
                ,{field:'xssl', title: '销售数量',align:"center" ,sort: true}
            ]],
            parseData:function (res) {
                return {
                    "code": res.status,
                    "msg": res.message,
                    "count": res.total,
                    "data": res.data.item
                };
            },
            done:function (res, curr, count) {
                var byId = function(id) {
                    return document.getElementById(id);
                };
                var barChart = echarts.init(byId('barChart'));
                var list = new Array();
                $.each(res.data , function (key ,val) {
                    list.push(percent(val.xsje,val.total));
                    datas.push({value:val.xssl, name:val.jd})
                    zxtdatas.push(val.xsje)
                })
                barChart.setOption(getOption(list));

                var barChart = echarts.init(byId('bold'));
                barChart.setOption(option);

                var barChart = echarts.init(byId('xsje'));
                barChart.setOption(zxtOption);
            }
        });
    });

    function percent(num, total) {
        num = parseFloat(num);
        total = parseFloat(total);
        if (isNaN(num) || isNaN(total)) {
            return "-";
        }
        return total <= 0 ? 0 : (Math.round(num / total * 100000) / 100.00);
    }



    var getOption = function(datas) {
        return  {
            title : {
                text: '各个季度占比',
                x:'center'
            },
            grid: {
                x: 35,
                x2: 10,
                y: 30,
                y2: 25
            },
            toolbox: {
                show : true,
                feature : {
                    dataView : {show: true, readOnly: false},
                    magicType : {show: true, type: ['line', 'bar']},
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            tooltip : {
                trigger: 'axis',
                formatter: "{a} <br/>{b} : {c}%"
            },
            toolbox: {
                show: false,
                feature: {
                    mark: {
                        show: true
                    },
                    dataView: {
                        show: true,
                        readOnly: false
                    },
                    magicType: {
                        show: true,
                        type: ['line', 'bar']
                    },
                    restore: {
                        show: true
                    },
                    saveAsImage: {
                        show: true
                    }
                }
            },
            calculable: false,
            xAxis: [{
                type: 'category',
                data: ['一季度', '二季度', '三季度', '四季度']
            }],
            yAxis: [{
                type: 'value',
                splitArea: {
                    show: true
                }
            }],
            series: [{
                name: '销售数据统计',
                type: "bar",
                data: datas
            }]
        };
    };



    option = {
        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b}: {c} ({d}%)"
        },
        title : {
            text: '销售数量',
            x:'center'
        },
        legend: {
            orient: 'vertical',
            x: 'left',
            data:['一季度','二季度','三季度','四季度']
        },
        series: [
            {
                name:'销售数量',
                type:'pie',
                radius: ['50%', '70%'],
                avoidLabelOverlap: false,
                label: {
                    normal: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        show: true,
                        textStyle: {
                            fontSize: '30',
                            fontWeight: 'bold'
                        }
                    }
                },
                labelLine: {
                    normal: {
                        show: false
                    }
                },
                data:datas,
            }
        ]
    };


    zxtOption = {
        title : {
            text: '销售金额',
            x:'center'
        },
        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b}: {c} ({d}万)"
        },
        xAxis: {
            type: 'category',
            data: ['一季度', '二季度', '三季度', '四季度']
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            data: zxtdatas,
            type: 'line'
        }]
    };


</script>
</body>
</html>