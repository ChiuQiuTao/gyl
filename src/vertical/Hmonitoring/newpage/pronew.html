<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>新增</title>
    <link rel="stylesheet" href="../../../../public/dist/css/layui.css">
    <link rel="stylesheet" href="../../../../css/twocss/commit.css">
    <link rel="stylesheet" href="../../../../css/twocss/H/processing.css">
</head>

<body>
    <div class="select common">
        <form class="layui-form" action="">
            <div class="select-title" style="height:40px;line-height:40px;">
                基本信息
            </div>

            <div class="basis-h">
                <div class="mess-pronew">

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">生产日期:</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input" id="temis">
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">产品条码:</label>
                            <div class="layui-input-inline">
                                <p class="tiaoma"></p>
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">生产重量:</label>
                            <div class="layui-input-inline" style="display: flex;align-items: center;">
                                <input type="text" class="layui-input">(<i>kg</i>)
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">仓库名称:</label>
                            <div class="layui-input-inline">
                                <select lay-filter="wareh" class="warehouses">
                                    <option value="">---请选择---</option>
                                    
                                </select>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="mess-pronew">

                    <div class="layui-form-item">
                        <div class="layui-inline ">
                            <label class="layui-form-label" style="width:95px;">产品名称:</label>
                            <div class="layui-input-inline ">
                                <select lay-filter="selec" class="selectfilters">
                                    <option value="">---请选择---</option>
                                    
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">生产批次:</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input batchs">
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">保质期:</label>
                            <div class="layui-input-inline">
                                <p class="baoj"></p>
                            </div>
                        </div>
                    </div>


                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">二级仓库名称:</label>
                            <div class="layui-input-inline">
                                <select lay-verify="Level2" class="Level2warehouse">
                                    <option value="">---请选择---</option>
                                   
                                </select>
                            </div>
                        </div>
                    </div>

                </div>


                <div class="mess-pronew">

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">负责人:</label>
                            <div class="layui-input-inline">
                                <select name="city" lay-verify="">
                                    <option value="">请选择</option>
                                    <option value="010">北京</option>
                                    <option value="021">上海</option>
                                    <option value="0571">杭州</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:95px;">生产数量:</label>
                            <div class="layui-input-inline" style="display: flex;align-items: center;">
                                <input type="text" class="layui-input">(<span class="nums">袋</span>)
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="select-title" style="height:30px;line-height:30px;margin-top: 10px;border-bottom-color:#c9c9c9;">
                配料信息
            </div>
            <div class="ingredients-newp"></div>

        </form>
        <div class="layui-btn-group" style="width: 100%;display: flex;justify-content: center;margin-top: 10px;">
            <button class="layui-btn"><i class="layui-icon">&#xe674;</i>保存</button>
            <button class="layui-btn huifan"><i class="layui-icon">&#xe65c;</i>返回</button>
        </div>
    </div>
</body>


<!-- 配料信息 -->
<script type="text/html" id="ingredientsdemo">
    <table class="layui-table" style="margin: 0;">
        <thead>
            <tr>
                <th></th>
                <th></th>
                <th>原辅料名称</th>
                <th>库存重量(kg)</th>
                <th>使用重量(kg)</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {{each list}}
            <tr>
                <td>{{$index}}</td>
                <td>
                    <div class="jia-btns "> +</div>
                </td>
                <td>{{$value.productName}}</td>
                <td>{{$value.stockNum}}</td>
                <td> <input type="text" class="layui-input" style="display:none;"></td>
                <td>
                    <div class="btns">
                        选择批次-仓库
                    </div>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</script>

<script src="../../../../js/common/jquery.min.js"></script>
<script src="../../../../js/common/api.js"></script>
<script src="../../../../public/dist/layui.js" charset="utf-8"></script>
<script src="../../../../js/common/template-web.js"></script>

</html>
<script>
    layui.use(['table', "layer", "form", "laydate", "util"], function() {
        var $ = layui.jquery,
            table = layui.table,
            layer = layui.layer,
            laydate = layui.laydate,
            form = layui.form,
            util = layui.util;


        //时间选择    
        laydate.render({
            elem: '#temis',
            done: function(value) {
                var batch = value
                batch = batch.split("-");
                batch = batch.join("");
                $(".batchs").val(batch);
            }
        });

        //产品名称
        handleAjax('OrdProcessing/getProcessingName', {}, "GET").done(function(resp) {
            console.log(resp)
            $.each(resp.list, function(index, item) {
                $('.selectfilters').append(new Option(item.productName, item.productId)); // 下拉菜单里添加元素
            });
            layui.form.render("select");
            return
        }).fail(function(err) {
            console.log(err)

        });

        //产品名称选中
        form.on('select(selec)', function(data) {
            var hh = $(this).text();
            //配料信息
            handleAjax('OrdProcessing/getProcessingMaterial', {
                productid: data.value
            }, "GET").done(function(resp) {
                var htmls = template("ingredientsdemo", resp);
                $(".ingredients-newp").html(htmls);
            }).fail(function(err) {
                console.log(err)
            });
            //保质期||条码
            handleAjax('OrdProcessing/getProcessingName', {
                productid: data.value
            }, "GET").done(function(resp) {

                $.each(resp.list, function(index, item) {
                    if (item.productName == hh) {
                        console.log(item)
                        $(".tiaoma").text(item.barCode);
                        $(".baoj").text(item.lifeDate + item.lifeDateUnit);
                    }
                });


                console.log(resp)
            }).fail(function(err) {
                console.log(err)

            });

        })





        //仓库名称
        var dataresps = null;
        handleAjax('OrdProcessing/getBasStorage', {}, "GET").done(function(resp) {
            dataresps = resp;
            $.each(resp.list, function(index, item) {
                $('.warehouses').append(new Option(item.storagename, item.id));
            });
            layui.form.render("select");
            return;
        }).fail(function(err) {
            console.log(err)

        });



        function ssd(dataresps) {
            var ssdds = null;
            $.each(dataresps.list, function(index, item) {
                ssdds += item.storagename
            });
            return ssdds;
        }

        //仓库选中
        form.on('select(wareh)', function() {
            var elees = $(this).text(),
                stingg = ssd(dataresps);

            if (stingg.indexOf(elees) != -1) {

            }



            // $.each(dataresps.list, function(index, item) {

            //     if (item.childNodes && item.storagename == elees) {
            //         $.each(item.childNodes, function(i, items) {

            //             $('.Level2warehouse').children().remove();
            //             $('.Level2warehouse').append(new Option(items.storagename, items.id));
            //         })

            //     }
            // });
            // if (item.childNodes == null) {
            //     $('.Level2warehouse').children().remove();
            //     $('.Level2warehouse').append(new Option("---请选择---", ""));
            // }


            layui.form.render("select");
            return
            $(this).text()
            console.log(data.value); //得到被选中的值
        })


        //返回
        $(".huifan").click(function() {
            window.location.href = "../../Hmonitoring/processing.html";
        })

    })
</script>