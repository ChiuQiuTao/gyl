<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>仓库信息</title>
    <link rel="stylesheet" href="../../../../public/dist/css/layui.css">
    <link rel="stylesheet" href="../../../../public/font/iconfont.css">
    <link rel="stylesheet" href="../../../../css/twocss/commit.css">
</head>
<body>
    <form class="layui-form" action="">

        <div class="select common">
            <div class="select-title">查询条件</div>
            <div class="select-con">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">仓库名称:</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" data-type="storageName">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:105px;">二级仓库名称:</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" data-type="storageName2">
                        </div>
                    </div>
                </div>
                <div class="select-btn">
                    <div class="layui-bg-green comquery " lay-event="search">查询</div>
                    <div class="layui-bg-green comquery " lay-event="reset">重置</div>
                </div>
            </div>
        </div>
    </form>

    <div class="common-padding">
        <table class="layui-hide" id="test" lay-filter="test"></table>
    </div>
</body>
<!-- 头部 -->
<script type="text/html" id="toolbarinter">
    <div class="layui-btn-container ">
        <button class="layui-btn  layui-btn-sm colors" lay-event="add"><i class="layui-icon"></i></i>添加</button>
        <button class="layui-btn  layui-btn-sm colors" lay-event="update"><i class="layui-icon"></i>编辑</button>
        <button class="layui-btn  layui-btn-sm colors" lay-event="delete"><i class="layui-icon"></i>删除</button>
    </div>
</script>

<!-- 里面的查看 -->
<script type="text/html" id="More">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
</script>

<script src="../../../../js/common/jquery.min.js"></script>
<script src="../../../../js/common/api.js"></script>
<script src="../../../../public/dist/layui.js" charset="utf-8"></script>
<script>
    layui.define(['table','layer'], function (exports) {
       var  table = layui.table,$ = jquery =layui.jquery;
        var server = table.render({
                elem: '#test',
                url: baseaip+"plant/ckxxs",
                method: 'GET',
                where: {
                    repositorytype:3,
                    storageName:$("input[data-type='storageName']").val(),
                    storageName2:$("input[data-type='storageName2']").val()
                },
                headers: {
                    Authorization: "Bearer" + " " + sessions
                },
                toolbar: '#toolbarinter',
                page: true,
                response: {
                    statusName: "code",
                    statusCode: 200,
                    msgName: "msg",
                    countName: "totalNum",
                    dataName: "data"
                },
                parseData: function(res) {
                    return {
                        "code": res.code,
                        "msg": res.msg,
                        "count": res.data.totalElements,
                        "data": res.data.content
                    };
                },
                cols: [[
                    {type: 'checkbox', fixed: 'left'},
                    {field: 'parentname', sort: true, title: '仓库名称'},
                    {field: 'storagename', sort: true, title: '二级仓库名称'},
                    {field: 'chargeperson', sort: true, title: '负责人'},
                ]],
                done:function () {
                    bindEvent()
                }
        });
        //加载事件
        function bindEvent(){
            $("div[lay-event='search']").unbind("click").on("click",function () {
                server.reload({where: {repositorytype:3, storageName:$("input[data-type='storageName']").val(), storageName2:$("input[data-type='storageName2']").val()
                    },page: {curr: 1}})
            });
            $("div[lay-event='reset']").unbind("click").on("click",function () {
                $("input[data-type='storageName'],input[data-type='storageName2']").val("");
                server.reload({where: {repositorytype:3, storageName:$("input[data-type='storageName']").val(), storageName2:$("input[data-type='storageName2']").val()},page: {curr: 1}})
            });
            $("button[lay-event='add']").unbind("click").on("click",function () {
                console.log(window.location.href)
                window.location.href = "./dialog/inventoryDialog.html";
            });
            $("button[lay-event='update']").unbind("click").on("click",function () {
                var data = table.checkStatus("test");
                data.data.length === 1 ? (function () {
                    console.log(data);
                    // return;
                    window.location.href = "./dialog/inventoryDialog.html?id="+data.data[0].id;
                })():alerts("请选择一条数据")
            });
            $("button[lay-event='delete']").unbind("click").on("click",function () {
                var data = table.checkStatus("test");
                data.data.length === 1 ? (function () {
                    Theoldcuiway(
                        "plant/deleteCkxx", {
                            ckxxId: data.data[0].id
                        },
                        "POST"
                    )
                        .done(function(resp) {
                            console.log(resp);
                            layer.msg('删除成功');
                            setTimeout(function(){
                                server.reload({where: {repositorytype:3, storageName:$("input[data-type='storageName']").val(), storageName2:$("input[data-type='storageName2']").val()
                                    },page: {curr: 1}})
                            },1500)
                            return;
                        })
                        .fail(function(err) {
                            console.log(err);
                        });
                })():alerts("请选择一条数据")
            });
        }
    })
</script>

</html>