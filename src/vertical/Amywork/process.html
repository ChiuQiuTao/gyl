<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>我的流程</title>
    <link rel="stylesheet" href="../../../css/twocss/public.css">
    <link rel="stylesheet" href="../../../public/dist/css/layui.css">
    <link rel="stylesheet" href="../../../css/twocss/aprocess.css">
    <link rel="stylesheet" href="../../../public/font/iconfont.css">
</head>

</html>
<div class="process-con">
    <div class="process-l bgfff">
        <div class="process-l-top">
            <div class="process-l-top-l">
                <div class="bgred"></div>
                <p>sdfds</p>
                <input type="text" class="layui-input">
            </div>
            <div class="process-l-top-r">
                <button class="layui-btn  layui-btn-sm process-add">新增</button>
                <button class="layui-btn layui-btn-sm  proeditor">编辑</button>
            </div>
        </div>
        <div class="process-editor">
            <ul>
                <li class="process-editor-one">
                    <a href="javascript:;"><i class="iconfont icon-tianjia" size="20"></i>增加流程</a>
                </li>
                <li class="process-editor-lis">

                    <table border="1" align="center">
                        <tbody>
                            <tr>
                                <td class="lzhong">
                                    <p class="lt"><i class="iconfont icon-lt"></i> </p>


                                </td>
                                <td class="lzhong">
                                    <p class="t" style="margin:0 auto;">
                                        <i class="iconfont icon-t"></i>
                                    </p>
                                </td>
                                <td class="lzhong">
                                    <p class="tr">
                                        <i class="iconfont icon-rt"></i>
                                    </p>
                                </td>
                                <td class="lzhong">
                                    <p class="tr">
                                        <i class="iconfont icon-rt"></i>
                                    </p>
                                </td>
                            </tr>


                            <tr>
                                <td class="lzhong">
                                    <p class="l">
                                        <i class="iconfont icon-l"></i>
                                    </p>
                                </td>
                                <td class="table-zhong" style="width:100px;">
                                    <div class="table-text">
                                        <div>
                                            <a class="sl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <span class="table-tex-zhong">坚实的副教授积分</span>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                    </div>
                                </td>

                                <td class="lzhong">
                                    <p class="r">
                                        <i class="iconfont icon-r"></i>
                                    </p>
                                </td>

                                <td class="table-zhong" style="width:100px;">
                                    <div class="table-text">
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <span class="table-tex-zhong">坚实的副教授积分</span>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td class="lzhong">
                                    <p class="lt">
                                        <i class="iconfont icon-lt"></i>
                                    </p>
                                </td>
                                <td class="lzhong">
                                    <p class="t" style="margin:0 auto;">
                                        <i class="iconfont icon-t"></i>
                                    </p>
                                </td>
                                <td class="lzhong">
                                    <p class="tr">
                                        <i class="iconfont icon-rt"></i>
                                    </p>
                                </td>
                                <td class="lzhong">
                                    <p class="tr">
                                        <i class="iconfont icon-rt"></i>
                                    </p>
                                </td>
                            </tr>

                            <tr>
                                <td class="lzhong">
                                    <p class="l">
                                        <i class="iconfont icon-l"></i>
                                    </p>
                                </td>
                                <td class="table-zhong" style="width:100px;">
                                    <div class="table-text">
                                        <div>
                                            <a class="sl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <span class="table-tex-zhong">坚实的副教授积分</span>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                    </div>
                                </td>

                                <td class="lzhong">
                                    <p class="r">
                                        <i class="iconfont icon-r"></i>
                                    </p>
                                </td>

                                <td class="table-zhong" style="width:100px;">
                                    <div class="table-text">
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <span class="table-tex-zhong">坚实的副教授积分</span>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                        <div>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                            <a href="javascript:;"><i class="iconfont icon-tianjia"></i></a>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                        </tbody>
                    </table>

                </li>
            </ul>
        </div>
    </div>
    <div class="process-r bgfff">
        <div class="process-r-li">
            <a href="javascript:;" class="bgred"></a>
            <p>流程图列表</p>
        </div>
        <ul>

        </ul>
    </div>
</div>
</body>
<script src="../../../public/dist/layui.js"></script>

</html>
<script>
    geteditor()

    function geteditor() {
        document.querySelector(".process-editor>ul").style.height = document.documentElement.clientHeight - 70 + "px";
        addedi()
    }

    function addedi() {
        layui.use('layer', function() {
            var $ = layui.$,
                layer = layui.layer,
                namesli = null,
                lisname = null;
            $(".process-add").click(function() {
                var _this = $(this);
                //新增
                $('.process-l-top-l>p').css("display", "none");
                if ($(this).text() == "新增") {
                    layer.open({
                        title: "输入流程图名称",
                        offset: ['100px'],
                        Number: 1,
                        content: '<input type="text" class="layui-input newlis">',
                        btn: ['确定'],
                        btnAlign: 'c',
                        yes: function(index) {
                            if ($(".newlis").val() == "") {
                                alert("请输入流程图名称！");
                                return;
                            }
                            $(".process-l-top-l>input").css("display", "block");
                            $(".process-editor-one").css("display", "block");
                            $(".process-l-top-l>input").val($(".newlis").val());
                            _this.text("取消新增");
                            $(".proeditor").text("保存");
                            //列表
                            lisname = '<li>' + $(".newlis").val() + '</li>'
                            $(".process-r>ul").append(lisname);
                            layer.close(layer.index);
                            return;
                        }
                    });
                    return;
                }
                //取消新增
                if ($(this).text() == "取消新增") {
                    var r = confirm("你确定放弃当前修改，取消新增？")
                    if (r == true) {
                        hidden();
                        _this.text("新增");
                        $(".proeditor").text("编辑");
                        console.log(lisname)
                        $(".process-r>ul>li:last-child").remove();
                    }
                    return;
                }
                //删除
                if ($(this).text() == "删除") {
                    var r = confirm('你确定要删除当前流程图？');
                    if ($(".process-r>ul>li").length > 0) {
                        var r = confirm('你确定要删除当前流程图[' + namesli + ']？')
                    }
                    if (r == true) {
                        hidden();
                        _this.text("新增");
                        $(".proeditor").text("编辑");
                    }
                    return;
                }
                return;
            })

            //编辑||保存
            $(".proeditor").click(function() {
                var _thiss = $(this);
                $('.process-l-top-l>p').css("display", "none");
                if ($(this).text() == "编辑") {
                    $(".process-l-top-l>input").css("display", "block");
                    $(".process-editor-one").css("display", "block");
                    _thiss.text("保存");
                    $(".process-add").text("删除");
                    return;
                }
                if ($(this).text() == "保存") {
                    if ($(".process-l-top-l>input").val() == "") {
                        alert("流程图名称不能为空！")
                        return;
                    } else {
                        layer.msg('确定保存?', {
                            time: 20000, //20s后自动关闭
                            offset: ["20px"],
                            btn: ['确认'],
                            btnAlign: 'c',
                            yes: function(index) {
                                $(".process-r>ul").append('<li class="prolis">' + $(".process-l-top-l>input").val() + '</li>');
                                hidden();
                                _thiss.text("编辑");
                                $(".process-add").text("新增");

                                $('.process-l-top-l>p').text($(".process-r>ul>li:last-child").text());
                                layer.close(layer.index);
                                return;
                            }
                        });
                    }
                }
                return;
            })



            //流程图列表
            $(document).on("click", ".prolis", function() {
                console.log("d")
            })

            //流程图
            $(".process-editor-one>a").click(function() {
                $(".process-editor>ul").append('<li style="position:relative; background-color:#fff;overflow-x: scroll;">' + elus("坚实的副教授积分") + '</li>')
            })

            //添加流程块
            var times = null;
            $(document).on("mouseover mouseout", ".table-tex-zhong", function(event) {
                var elme = $(this).parents(".table-text").children("div").children("a").children("i");
                if (event.type == "mouseover") {
                    //鼠标悬浮 
                    clearTimeout(times);
                    elme.show();
                    settime = false;
                    return
                }
                if (event.type == "mouseout") {
                    //鼠标离开
                    times = setTimeout(function() {
                        elme.hide();
                        return;
                    }, 35)

                    elme.hover(function() {
                        clearTimeout(times);
                        elme.show();
                        return;
                    }, function() {
                        elme.hide();
                        return;
                    })
                }
            })

            //加块

            $(document).on("click", ".table-text>div>a>i", function() {
                var nums = 0;
                var clickjia = $(this).parent().attr("class");
                var _the = this;
                var parenter = $(_the).parents(".table-zhong").parent();
                var parente = $(_the).parents(".table-zhong");
                var nus = Number($(this).parent().parent().next().children("span").attr("date-num"));
                var elee;
                switch (clickjia) {
                    case "sl":

                        nums = nus + 2;
                        elee = nums - 1;
                        if (parenter.prev().prev().length > 0) {
                            alert("1")
                        } else {

                            if (parente.prev().length > 0) {

                            } else {
                                parente.before("<td></td>");
                                parente.before(fxl(elee));
                            }
                            parenter.before(fx(elee)); //指向条的个数
                            parenter.prev().before(zhengkuai(nums, "热热热若"));

                            console.log(parenter.prev().children().length)
                        }
                        $(_the).remove();
                        break;
                    case "sz":


                        break;
                    case "sr":
                        console.log("53")
                        break;
                    case "rr":
                        console.log("54")
                        break;
                    case "xr":
                        console.log("55")
                        break;
                    case "xz":
                        console.log("56")
                        break;
                    case "xl":
                        console.log("57")
                        break;
                    case "ll":
                        console.log("58")
                        break;
                    default:
                        console.log('其他')
                }

            })

            //隐藏元素
            function hidden() {
                $(".process-l-top-l>input").css("display", "none");
                $(".process-editor-one").css("display", "none");
                $(".process-l-top-l>input").val("");
                $('.process-l-top-l>p').css("display", "block");
            }

            //加方向
            //上
            function fx(ee) {
                var ds
                for (i = 0; i < ee; i++) {
                    ds += '<td>' + "" + '</td>'
                }
                var fxs = '<tr>' +
                    ds +
                    '<td class="lzhong"><p class="lt"><i class="iconfont icon-lt"></i></p></td>' +
                    '<td class="lzhong"><p class="t" style="margin:0 auto;"></p></td>' +
                    '</tr>'
                return fxs
            }
            //下
            function fxx() {
                var ds = '<tr>' +
                    '<td class="lzhong"><p class="lb"></p></td>' +
                    '<td class="lzhong"><p class="b" style="margin:0 auto;"></p></td>' +
                    '<td class="lzhong"><p class="rb"> </p> </td></tr>'
                return ds
            }
            //左
            function fxl(d) {
                var df
                for (var i = 0; i < d; i++) {
                    df += '<td>' + "" + '</td>'
                }
                return df
            }
            // 右
            function fxr() {
                var sf = '<td class="lzhong"><p class="r"></p></td>'
                return sf
            }

            function qian(q) {
                var qian;
                for (var i = 0; i < q; i++) {
                    qian += '<td>' + "" + '</td>'
                }
                return qian
            }

            //块
            function zhengkuai(un, texs) {
                var sds =
                    '<tr>' +
                    '<td class="table-zhong" style="width:100px;"><div class="table-text">' +
                    '<div><a class="sl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="ll" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="xl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '</div>' +
                    '<div><a class="sz" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<span class="table-tex-zhong" date-num="' + un + '">' + texs + '</span>' +
                    '<a class="xz" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '</div>' +
                    '<div><a class="sr" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="rr" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="xr" href="javascript:;"></a>' +
                    '</div>' +
                    '</div></td>' +
                    '</tr>'
                return sds
            }
            //加整块text
            function zk(un, texs) {
                var sds =
                    '<td class="table-zhong" style="width:100px;"><div class="table-text">' +
                    '<div><a class="sl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="ll" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="xl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '</div>' +
                    '<div><a class="sz" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<span class="table-tex-zhong" date-num="' + un + '">' + texs + '</span>' +
                    '<a class="xz" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '</div>' +
                    '<div><a class="sr" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="rr" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="xr" href="javascript:;"></a>' +
                    '</div>' +
                    '</div></td>'
                return sds

            }


            //加整体
            function elus(texs) {
                var datadiv =
                    '<table border="1" align="center">' +
                    '<tbody>' +
                    '<tr>' +
                    '<td class="table-zhong" style="width:100px;"><div class="table-text">' +
                    '<div><a class="sl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="ll" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="xl" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '</div>' +
                    '<div><a class="sz" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<span class="table-tex-zhong" date-num="0">' + texs + '</span>' +
                    '<a class="xz" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '</div>' +
                    '<div><a class="sr" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="rr" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '<a class="xr" href="javascript:;"><i class="iconfont icon-tianjia"></i></a>' +
                    '</div>' +
                    '</div></td></tr>' +
                    '</tbody>' +
                    '</table>'
                return datadiv
            }
        });
    }
</script>